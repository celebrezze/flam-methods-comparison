---
title: "Variance Decomposition"
author: "Joe Celebrezze"
date: "4/8/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Loading in necessary packages
```{r, include = FALSE}
library(tidyverse)
select = dplyr::select
library(here)
here = here::here
library(vars) #for variance decomposition
library(lme4) #for mixed effects models
library(reshape2) #for "melting" dataframe into longer form (variance decomposition)
library(MuMIn) # extracting r squared values of mixed effects models
#Add in packages as necessary so no redundant packages
```

# Loading in datasets
```{r, include = FALSE}
main_df <- read_csv(here("processed-data/compiled-datasets/METHODS/bothmethods_bothlocations_long.csv"))
```

# Data Wrangling
```{r}
vd_main_df <- main_df %>% 
  filter(ignition == 1) %>% # Only looking at samples that ignited
  select(fh, tti, ttfg, fd, gd, gti, temp_max, mpa, 
         lfm_outliers_out, spp, model, location, 
         precip_2mo, individual, sample_wt) %>% 
  mutate(dry_wt = sample_wt/(0.01*lfm_outliers_out+1)) %>%  # I know dry_wt was already the name of a column in main_df, but it isn't a useful column and it is a useful name, so I am taking that name for vd_main_df but it means the dry weight of the sample being burned in this case
  mutate(water_wt = sample_wt - dry_wt) %>%
  na.omit()

# I selected all flam. traits (going to do mem for each one) and the water content/status metrics as well as potential random effects in location, time (precip_2mo used as an indication of time), and individual
```

## Normalizing flam. metrics
```{r}
vd_main_df <- vd_main_df %>% 
  mutate(fh_norm = fh/sample_wt, tti_norm = tti/sample_wt, ttfg_norm = ttfg/sample_wt, fd_norm = fd/sample_wt, gd_norm = gd/sample_wt, gti_norm = gti/sample_wt, temp_max_norm = temp_max/sample_wt)
```

# 1. Mixed effects models (Normalized)
The following models are with normalized data!

Note: I selected these models based on the model selection process shown in MEM_hp_vs_epi.Rmd; see the conclusions at the bottom of the .Rmd for some explanation as to why

## Hot Plate
```{r}
hpMEMfh <- lmer(data = vd_main_df, subset = model == "HP", fh_norm ~ mpa + spp + (1|precip_2mo) + (1|location) + (1|individual))

hpMEMtti <- lmer(data = vd_main_df, subset = model == "HP", tti_norm ~ mpa + spp + (1|precip_2mo) + (1|location) + (1|individual))

hpMEMfd <- lmer(data = vd_main_df, subset = model == "HP", fd_norm ~ mpa + spp + (1|precip_2mo) + (1|location) + (1|individual))

hpMEMgti <- lmer(data = vd_main_df, subset = model == "HP", gti_norm ~ mpa + spp + (1|precip_2mo) + (1|location) + (1|individual))

hpMEMttfg <- lmer(data = vd_main_df, subset = model == "HP", ttfg_norm ~ mpa + spp + (1|precip_2mo) + (1|location) + (1|individual))

hpMEMtemp_max <- lmer(data = vd_main_df, subset = model == "HP", temp_max_norm ~ mpa + spp + (1|precip_2mo) + (1|location) + (1|individual))

hpMEMgd <- lmer(data = vd_main_df, subset = model == "HP", gd_norm ~ mpa + spp + (1|precip_2mo) + (1|location) + (1|individual))
```

## Epiradiator
```{r}
epiMEMfh <- lmer(data = vd_main_df, subset = model == "EPI", fh_norm ~ mpa + spp + (1|precip_2mo) + (1|location) + (1|individual))

epiMEMtti <- lmer(data = vd_main_df, subset = model == "EPI", tti_norm ~ mpa + spp + (1|precip_2mo) + (1|location) + (1|individual))

epiMEMfd <- lmer(data = vd_main_df, subset = model == "EPI", fd_norm ~ mpa + spp + (1|precip_2mo) + (1|location) + (1|individual))

epiMEMgti <- lmer(data = vd_main_df, subset = model == "EPI", gti_norm ~ mpa + spp + (1|precip_2mo) + (1|location) + (1|individual))

epiMEMttfg <- lmer(data = vd_main_df, subset = model == "EPI", ttfg_norm ~ mpa + spp + (1|precip_2mo) + (1|location) + (1|individual))

epiMEMtemp_max <- lmer(data = vd_main_df, subset = model == "EPI", temp_max_norm ~ mpa + spp +  (1|precip_2mo) + (1|location) + (1|individual))

epiMEMgd <- lmer(data = vd_main_df, subset = model == "EPI", gd_norm ~ mpa + spp + (1|precip_2mo) + (1|location) + (1|individual))
```

# Extracting R Squared Values

## Hot Plate
```{r}
hpMEMlist <- list(hpMEMfh, hpMEMtti, hpMEMfd, hpMEMgti, hpMEMttfg, hpMEMtemp_max, hpMEMgd) # first make a list of all the models
lapply(hpMEMlist, r.squaredGLMM) # then apply the r.squaredGLMM() function to all of the models on that list
```

## Epiradiator
Repeating the same process as above
```{r}
epiMEMlist <- list(epiMEMfh, epiMEMtti, epiMEMfd, epiMEMgti, epiMEMttfg, epiMEMtemp_max, epiMEMgd)
lapply(epiMEMlist, r.squaredGLMM)
```

## Dataframe
```{r}
# Long
flam.metric <- c(rep(c("Flame Height", "Time to Ignition", "Flame Duration", "Glow to Ignition", "Time to First Glow", "Maximum Temperature", "Glow Duration"), 2)) # making a vector for the flam. metrics (long df)
R2m <- c(0.002442825, 0.3583603, 0.1595683, 0.1125589, 0.2398103, 0.2654801, 0.01173839, 0.1186719, 0.2143339, 0.06611646, 0.1028824, 0.1369928, 0.07965624, 0.2115174) # making a vector for the maginal r squared values -- I am sure there is a more elegant way to do this, but didn't feel like figuring it out
model <- c(rep("HP", 7), rep("EPI", 7)) # so we can assign the above values to the correct model
vd_R2_df_long <- data.frame(flam.metric, R2m, model)

# Wide
R2m_hp <- c(0.002442825, 0.3583603, 0.1595683, 0.1125589, 0.2398103, 0.2654801, 0.01173839) # Only for hot plate
R2m_epi <- c(0.1186719, 0.2143339, 0.06611646, 0.1028824, 0.1369928, 0.07965624, 0.2115174) # Only for epiradiator
flamm.metric <- c("Flame Height", "Time to Ignition", "Flame Duration", "Glow to Ignition", "Time to First Glow", "Maximum Temperature", "Glow Duration") # Vector name is lame -- sorry
vd_R2_df_wide <- data.frame(flamm.metric, R2m_hp, R2m_epi)
```

# Data Visualization

## Scatterplot
```{r}
ggplot(vd_R2_df_wide, aes(x = R2m_hp, y = R2m_epi, color = flamm.metric)) + 
  geom_point() +
  geom_abline() +
  scale_x_continuous(limits = c(0, 0.4)) +
  scale_y_continuous(limits = c(0, 0.4)) +
  labs(x = "Hot Plate Marginal R Squared", y = "Epiradiator Marginal R Squared", color = "Flammability Metric") +
  theme_bw()
```

## Barplot
```{r}
ggplot(vd_R2_df_long, aes(x = flam.metric, y = R2m, fill = model)) +
  geom_bar(position = "dodge", stat = "identity") +
  labs(x = "Flammability Metric", y = "Marginal R Squared", fill = "Model") +
  theme_bw()

ggsave("vardecomp.model1.jpg", height = 7, width = 10)
```

Initial interpretation: in general, mpa and species explain more of the variation in time to ignition than any other flam. metric. When looking at differences between the two models, the hot plate design has more variation accounted for by these fixed effects in 4/7 metrics (and just marginally more in glow to ignition), while the epiradiator only explains more variation in only flame height and glow duration. In these two metrics, the marginal Rsq for the hot plate design is painfully low (0.00244 for flame height, 0.01173); however, the conditional Rsq for these metrics are incredibly high for some reason. Why might this be? Also, how do we know if the differences in marginal Rsq between metrics and/or between models are at all significant?

# 2. Mixed effects models (wet and dry weights)
See MEM_hp_vs_epi.Rmd for explanation as to why including both and why maximal model is chosen for the following mixed effects models

## Hot Plate
```{r}
hpMEMfh2 <- lmer(data = vd_main_df, subset = model == "HP", fh ~ mpa + spp + water_wt + dry_wt + (1|precip_2mo) + (1|location) + (1|individual))

hpMEMtti2 <- lmer(data = vd_main_df, subset = model == "HP", tti ~ mpa + spp + water_wt + dry_wt + (1|precip_2mo) + (1|location) + (1|individual))

hpMEMfd2 <- lmer(data = vd_main_df, subset = model == "HP", fd ~ mpa + spp + water_wt + dry_wt + (1|precip_2mo) + (1|location) + (1|individual))

hpMEMgti2 <- lmer(data = vd_main_df, subset = model == "HP", gti ~ mpa + spp + water_wt + dry_wt + (1|precip_2mo) + (1|location) + (1|individual))

hpMEMttfg2 <- lmer(data = vd_main_df, subset = model == "HP", ttfg ~ mpa + spp + water_wt + dry_wt + (1|precip_2mo) + (1|location) + (1|individual))

hpMEMtemp_max2 <- lmer(data = vd_main_df, subset = model == "HP", temp_max ~ mpa + spp + water_wt + dry_wt + (1|precip_2mo) + (1|location) + (1|individual))

hpMEMgd2 <- lmer(data = vd_main_df, subset = model == "HP", gd ~ mpa + spp + water_wt + dry_wt + (1|precip_2mo) + (1|location) + (1|individual))
```

## Epiradiator
```{r}
epiMEMfh2 <- lmer(data = vd_main_df, subset = model == "EPI", fh ~ mpa + spp + water_wt + dry_wt + (1|precip_2mo) + (1|location) + (1|individual))

epiMEMtti2 <- lmer(data = vd_main_df, subset = model == "EPI", tti ~ mpa + spp + water_wt + dry_wt + (1|precip_2mo) + (1|location) + (1|individual))

epiMEMfd2 <- lmer(data = vd_main_df, subset = model == "EPI", fd ~ mpa + spp + water_wt + dry_wt + (1|precip_2mo) + (1|location) + (1|individual))

epiMEMgti2 <- lmer(data = vd_main_df, subset = model == "EPI", gti ~ mpa + spp + water_wt + dry_wt + (1|precip_2mo) + (1|location) + (1|individual))

epiMEMttfg2 <- lmer(data = vd_main_df, subset = model == "EPI", ttfg ~ mpa + spp + water_wt + dry_wt + (1|precip_2mo) + (1|location) + (1|individual))

epiMEMtemp_max2 <- lmer(data = vd_main_df, subset = model == "EPI", temp_max ~ mpa + spp + water_wt + dry_wt +  (1|precip_2mo) + (1|location) + (1|individual))

epiMEMgd2 <- lmer(data = vd_main_df, subset = model == "EPI", gd ~ mpa + spp + water_wt + dry_wt + (1|precip_2mo) + (1|location) + (1|individual))
```

# Extracting R Squared Values

## Hot Plate
```{r}
hpMEMlist2 <- list(hpMEMfh2, hpMEMtti2, hpMEMfd2, hpMEMgti2, hpMEMttfg2, hpMEMtemp_max2, hpMEMgd2) # first make a list of all the models
lapply(hpMEMlist2, r.squaredGLMM) # then apply the r.squaredGLMM() function to all of the 
```

## Epiradiator
Repeating the same process as above
```{r}
epiMEMlist2 <- list(epiMEMfh2, epiMEMtti2, epiMEMfd2, epiMEMgti2, epiMEMttfg2, epiMEMtemp_max2, epiMEMgd2)
lapply(epiMEMlist2, r.squaredGLMM)
```

## Dataframe
```{r}
# Long
R2m.2 <- c(0.1122344, 0.2188093, 0.1002294, 0.1761298, 0.1220561, 0.3879243, 0.1291621, 0.1342083, 0.2607583, 0.1047679, 0.116085, 0.1182752, 0.1963169, 0.241774) # making a vector for the maginal r squared values -- I am sure there is a more elegant way to do this, but didn't feel like figuring it out
vd_R2_df_long2 <- data.frame(flam.metric, R2m.2, model)
vd_R2_df_long2 <- vd_R2_df_long2 %>% 
  rename(R2m = R2m.2) # renaming column name

# Wide
R2m_hp.2 <- c(0.1122344, 0.2188093, 0.1002294, 0.1761298, 0.1220561, 0.3879243, 0.1291621) # Only for hot plate
R2m_epi.2 <- c(0.1342083, 0.2607583, 0.1047679, 0.116085, 0.1182752, 0.1963169, 0.241774) # Only for epiradiator
vd_R2_df_wide2 <- data.frame(flamm.metric, R2m_hp.2, R2m_epi.2)
vd_R2_df_wide2 <- vd_R2_df_wide2 %>% 
  rename(R2m_hp = R2m_hp.2) %>% 
  rename(R2m_epi = R2m_epi.2) # renaming column names
```

# Data Visualization

## Scatterplot
```{r}
ggplot(vd_R2_df_wide2, aes(x = R2m_hp, y = R2m_epi, color = flamm.metric)) + 
  geom_point() +
  geom_abline() +
  scale_x_continuous(limits = c(0, 0.4)) +
  scale_y_continuous(limits = c(0, 0.4)) +
  labs(x = "Hot Plate Marginal R Squared", y = "Epiradiator Marginal R Squared", color = "Flammability Metric") +
  theme_bw()
```

## Barplot
```{r}
ggplot(vd_R2_df_long2, aes(x = flam.metric, y = R2m, fill = model)) +
  geom_bar(position = "dodge", stat = "identity") +
  labs(x = "Flammability Metric", y = "Marginal R Squared", fill = "Model") +
  theme_bw()

ggsave("vardecomp.model2.jpg", height = 7, width = 10)
```

Initial interpretation: first, these models with wet weight, dry weight, mpa and spp appeared to have less of a difference between the two flam. chamber models we are comparing. Specifically, flame durration, flame height and time to first glow appear to have only marginally different marginal Rsq values. The epiradiator model has more of the variation described by the fixed effects for 2 out of the remaining 4 metrics (glow duration and time to ignition). Interestingly, the marginal Rsq value went DOWN for the hot plate design for the time to ignition metric (how do we explain this?). For maximum temperature and glow to igntion, we see more variation being explained by the fixed effects in the hot plate design over the epiradiator design.

# 3. Comparing Marginal Rsq for Model 1 vs. Model 2

## Getting dataset ready
```{r}
both_df_list <- list(vd_R2_df_long, vd_R2_df_long2)

vd_R2_df_both <- both_df_list %>% 
  reduce(full_join, by = "flam.metric") %>% 
  rename(model1 = model.x, model2 = model.y, R2m1 = R2m.x, R2m2 = R2m.y) # Renaming where model1 and R2m1 are for the mixed effects models outlined in part 1, while the others are for maximal model outlined in part 2

vd_R2_df_epi <- vd_R2_df_both %>% 
  filter(model1 == "EPI" & model2 == "EPI") %>% 
  select(-model1, -model2) %>% 
  pivot_longer(!flam.metric) %>% 
  rename(R2m = value, mem.model = name)

vd_R2_df_hp <- vd_R2_df_both %>% 
  filter(model1 == "HP" & model2 == "HP") %>% 
  select(-model1, -model2) %>% 
  pivot_longer(!flam.metric) %>% 
  rename(R2m = value, mem.model = name)
```

## Barplot
This compares the marginal Rsq values for each mixed effects model, trying to understand if the addition of wet and dry weight positively or negatively affect the amount of variation described by the fixed effects in each model.
Model 1: only mpa and species
Model 2: mpa, wet weight, dry weight and species

### Epiradiator
```{r}
ggplot(vd_R2_df_epi, aes(x = flam.metric, y = R2m, fill = mem.model)) +
  geom_bar(position = "dodge", stat = "identity") +
  labs(x = "Flammability Metric", y = "Marginal R Squared", fill = "Mixed Effects Model", title = "Epiradiator") +
  theme_bw()
```
For almost all metrics, fixed effects in the maximal model explains more of the variation. This is especially true for maximum temperature. Why would the marginal Rsq decrease?

### Hot Plate
```{r}
ggplot(vd_R2_df_hp, aes(x = flam.metric, y = R2m, fill = mem.model)) +
  geom_bar(position = "dodge", stat = "identity") +
  labs(x = "Flammability Metric", y = "Marginal R Squared", fill = "Mixed Effects Model", title = "Hot Plate") +
  theme_bw()
```
The Rsq marginal actually decreases with the addition of two fixed effects - dry and wet weight - for 3/7 flam. metrics. Specifically, the decrease for time to ignition is quite large. Like the epiradiator design, for maximum temperature, we see wet and dry weight explaining a significant portion of the variation.

### Difference Between MEM Models
Data Wrangling
```{r}
vd_R2_df_diff <- vd_R2_df_both %>% 
  mutate(R2m.diff = R2m2 - R2m1) %>%  #adding difference column
  filter(model1 == "HP" & model2 == "HP" | model1 == "EPI" & model2 == "EPI") #only comparing epi to epi and hp to hp
```

Data Visualization
```{r}
ggplot(vd_R2_df_diff, aes(x = flam.metric, y = R2m.diff, fill = model1)) +
  geom_bar(position = "dodge", stat = "identity") +
  labs(x = "Flammability Metric", y = "Differrence Between R2m Values", fill = "Model") +
  theme_bw()

ggsave("vardecomp.difference.jpg", height = 7, width = 10)
```

# Lee meeting notes

Variance by psi, variance by dry weight; see if it tells us that psi tells us more for epi than hot plate

Test random effects on their own

Shift location, time (precip) as fixed effects

--------------------------------------------------------------------------------
------------------- Below this was my first crack at var. decomp. --------------
--------------------------------------------------------------------------------
# Lee Meeting Notes
Shift focus to looking at R2 values of each mem model (for all flam. metrics)
  Either a scatterplot of R2 for epi vs. R2 hotplate
  or..
  Barplot with epi vs. hot plate R2 for each of the flam. metrics
  
  If we want to look at specifically variance of spp vs. mpa then we would do mem of flam.metric ~ mpa + spp for total r2 and then flam.metric ~ mpa for mpa R2 and flam.metric ~ spp for spp R2 and then when spp R2 + mpa R2 is greater than total R2, the "extra" R2 is attributable to BOTH spp and mpa 



# Variance Decomposition by Group Visualizations
I have no experience doing anything like this. I am giving it a shot based on two Stack Overflow discussions and Lee's base plotting tutorial from R seminar, so interpret all of the below with extreme caution.


## Mixed effects models for all flam. traits for each model
### Hot Plate
Using mpa (not LFM) and spp
QQQ: I am really not sure what to include in the mixed effects models as random/fixed effects. Should I do some sort of model selection process beforehand or just include potential random effects and fixed effects of interest and hope that it is okay?
```{r}
hpMEMfh <- lmer(data = vd_main_df, subset = model == "HP", fh ~ mpa + spp + (1|precip_2mo) + (1|location) + (1|individual)) # precip_2mo is a time proxy that represents the amount of precipitation over the past two months

hpMEMtti <- lmer(data = vd_main_df, subset = model == "HP", tti ~ mpa + spp + (1|precip_2mo) + (1|location) + (1|individual))

hpMEMfd <- lmer(data = vd_main_df, subset = model == "HP", fd ~ mpa + spp + (1|precip_2mo) + (1|location) + (1|individual))

hpMEMgti <- lmer(data = vd_main_df, subset = model == "HP", gti ~ mpa + spp + (1|precip_2mo) + (1|location) + (1|individual))

hpMEMttfg <- lmer(data = vd_main_df, subset = model == "HP", ttfg ~ mpa + spp + (1|precip_2mo) + (1|location) + (1|individual))

hpMEMtemp_max <- lmer(data = vd_main_df, subset = model == "HP", temp_max ~ mpa + spp + (1|precip_2mo) + (1|location) + (1|individual))

hpMEMgd <- lmer(data = vd_main_df, subset = model == "HP", gd ~ mpa + spp + (1|precip_2mo) + (1|location) + (1|individual))
```

### Epiradiator
```{r}
epiMEMfh <- lmer(data = vd_main_df, subset = model == "EPI", fh ~ mpa + spp + (1|precip_2mo) + (1|location) + (1|individual))

epiMEMtti <- lmer(data = vd_main_df, subset = model == "EPI", tti ~ mpa + spp + (1|precip_2mo) + (1|location) + (1|individual))

epiMEMfd <- lmer(data = vd_main_df, subset = model == "EPI", fd ~ mpa + spp + (1|precip_2mo) + (1|location) + (1|individual))

epiMEMgti <- lmer(data = vd_main_df, subset = model == "EPI", gti ~ mpa + spp + (1|precip_2mo) + (1|location) + (1|individual))

epiMEMttfg <- lmer(data = vd_main_df, subset = model == "EPI", ttfg ~ mpa + spp + (1|precip_2mo) + (1|location) + (1|individual))

epiMEMtemp_max <- lmer(data = vd_main_df, subset = model == "EPI", temp_max ~ mpa + spp + (1|precip_2mo) + (1|location) + (1|individual))

epiMEMgd <- lmer(data = vd_main_df, subset = model == "EPI", gd ~ mpa + spp + (1|precip_2mo) + (1|location) + (1|individual))
r.squaredGLMM(epiMEMgd) # First number is marginal Rsq (only fixed effects), second is conditional Rsq (fixed effects and random effects) -- look at only fixed effects to start
```

## VarCorr Extraction
```{r}
# For hot plate trials
vc.hp.tti <- data.frame(VarCorr(hpMEMtti)) # VarCorr pulls out variance of random effects ONLY
vc.hp.fh <- data.frame(VarCorr(hpMEMfh))
vc.hp.gti <- data.frame(VarCorr(hpMEMgti))
vc.hp.ttfg <- data.frame(VarCorr(hpMEMttfg))
vc.hp.gd <- data.frame(VarCorr(hpMEMgd))
vc.hp.fd <- data.frame(VarCorr(hpMEMfd))
vc.hp.temp_max <- data.frame(VarCorr(hpMEMtemp_max))

# For epi trials
vc.epi.tti <- data.frame(VarCorr(epiMEMtti))
vc.epi.fh <- data.frame(VarCorr(epiMEMfh))
vc.epi.gti <- data.frame(VarCorr(epiMEMgti))
vc.epi.ttfg <- data.frame(VarCorr(epiMEMttfg))
vc.epi.gd <- data.frame(VarCorr(epiMEMgd))
vc.epi.fd <- data.frame(VarCorr(epiMEMfd))
vc.epi.temp_max <- data.frame(VarCorr(epiMEMtemp_max))
```

## Making a Dataframe with Variances
```{r}
vcData <- data.frame(vc.hp.tti[,4], vc.hp.fh[,4], vc.hp.gti[,4], 
                     vc.hp.ttfg[,4], vc.hp.gd[,4], vc.hp.fd[,4],
                     vc.hp.temp_max[,4], vc.epi.tti[,4], 
                     vc.epi.fh[,4], vc.epi.gti[,4], 
                     vc.epi.ttfg[,4], vc.epi.gd[,4],
                     vc.epi.fd[,4], vc.epi.temp_max[,4], 
                     row.names = c("WiTime", "WiLocation", "bLocation",
                                   "WiIndividual"))

colnames(vcData) <- c("HPtti", "HPfh", "HPgti", "HPttfg", "HPgd", "HPfd", "HPtemp_max", "EPItti", "EPIfh", "EPIgti", "EPIttfg", "EPIgd", "EPIfd", "EPItemp_max")

# Note: QQQ: how do I know what my rows mean? I used Lee's tutorial as an outline on how to do this, but I am not 100% sure if it will translate over well -- for now, I am just going to cross my fingers that it does
```

I am not sure if this is the best way to do this, so I am going to try another way that makes a bit more sense to me

Either of them could be right, but they could also both be wrong just as easily...

```{r}
#TTI
ttiVDF <- data.frame(vc.hp.tti[,4], vc.epi.tti[,4], row.names = c("WiTime", 
                    "WiLocation", "bLocation", "WiIndividual"))
colnames(ttiVDF) <- c("HP", "EPI")

#FH
fhVDF <- data.frame(vc.hp.fh[,4], vc.epi.fh[,4], row.names = c("WiTime", 
                    "WiLocation", "bLocation", "WiIndividual"))
colnames(fhVDF) <- c("HP", "EPI")

#GTI
gtiVDF <- data.frame(vc.hp.gti[,4], vc.epi.gti[,4], row.names = c("WiTime", 
                    "WiLocation", "bLocation", "WiIndividual"))
colnames(gtiVDF) <- c("HP", "EPI")

#TTFG
ttfgVDF <- data.frame(vc.hp.ttfg[,4], vc.epi.ttfg[,4], row.names = 
            c("WiTime", "WiLocation", "bLocation", "WiIndividual"))
colnames(ttfgVDF) <- c("HP", "EPI")

#GD
gdVDF <- data.frame(vc.hp.gd[,4], vc.epi.gd[,4], row.names = c("WiTime", 
                    "WiLocation", "bLocation", "WiIndividual"))
colnames(gdVDF) <- c("HP", "EPI")

#FD
fdVDF <- data.frame(vc.hp.fd[,4], vc.epi.fd[,4], row.names = c("WiTime", 
                    "WiLocation", "bLocation", "WiIndividual"))
colnames(fdVDF) <- c("HP", "EPI")

#Temp Max
temp_maxVDF <- data.frame(vc.hp.temp_max[,4], vc.epi.temp_max[,4],
              row.names = c("WiTime", "WiLocation", "bLocation", "WiIndividual"))
colnames(temp_maxVDF) <- c("HP", "EPI")

#Combining all of the above into a wide-form dataframe
wideVDF <- rbind(rbind(ttiVDF, colSums(ttiVDF)), rbind(fhVDF, colSums(fhVDF)), rbind(gtiVDF, colSums(gtiVDF)), rbind(ttfgVDF, colSums(ttfgVDF)), rbind(gdVDF, colSums(gdVDF)), rbind(fdVDF, colSums(fdVDF)), rbind(temp_maxVDF, colSums(temp_maxVDF)))

wideVDF$level <- rep(c("WiTime", "WiLocation", "bLocation", "WiIndividual", "Total"), times = 7) # Adding column for level
wideVDF$trait <- c(rep("tti", times=5), rep("fh", times = 5), rep("gti", times = 5), rep("ttfg", times = 5), rep("gd", times = 5), rep("fd", times = 5), rep("temp_max", times = 5)) # Adding column for traits

#Melting wide-form dataframe into long-form
longVDF <- melt(data = wideVDF, id.vars = c("level", "trait"), variable.name = "model")

#Renaming column
longVDF <- longVDF %>% 
  rename("variance" = "value")
```

Okay, so now I have a dataframe with variances between my random effects for the different flam. metrics and models. Let's try and visualize the variances

## Data Visualization
```{r}
longVDF$level <- factor(longVDF$level, levels = c("Total", "WiIndividual", "WiLocation", "bLocation", "WiTime"))

ggplot(longVDF, aes(x = level, y = variance, fill = trait)) +
  geom_bar(stat = "identity") +
  facet_wrap(~model, scales = "free_y") +
  labs(x = "Level", y = "Variance", fill = "Flam. Metric") +
  scale_fill_discrete(labels = c("Flame Duration", "Flame Height", "Glow Duration", "Glow to Ignition", "Maximum Temp.", "Time to First Glow", "Time to Ignition"))
  theme_bw()
```
QQQ: What do I get out of a plot like this? Other than a bit of anxiety...

